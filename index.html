<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermodynamics Piston Sim</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; }
        #sim-container { position: relative; width: 300px; height: 400px; background: white; border: 5px solid #333; border-top: none; margin-top: 50px; overflow: hidden; }
        #piston { position: absolute; bottom: 150px; width: 100%; height: 20px; background: #555; border-bottom: 3px solid #222; transition: bottom 0.3s ease-out; z-index: 10; }
        .atom { position: absolute; width: 8px; height: 8px; background: blue; border-radius: 50%; transition: background 0.5s; }
        #flame { position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%); font-size: 40px; display: none; }
        #stats { margin-top: 20px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); line-height: 1.6; }
        .controls { margin-top: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #ff4757; color: white; border: none; border-radius: 5px; }
        button:active { background: #e84118; }
        .eqn { font-weight: bold; color: #2f3542; }
    </style>
</head>
<body>

    <h2>First Law: $Q = \Delta U + W$</h2>
    
    <div id="sim-container">
        <div id="piston"></div>
        <div id="flame">ðŸ”¥</div>
    </div>

    <div class="controls">
        <button onmousedown="startHeat()" onmouseup="stopHeat()" onmouseleave="stopHeat()">Add Heat (Q)</button>
        <button onclick="resetSim()" style="background: #747d8c;">Reset</button>
    </div>

    <div id="stats">
        <div><strong>Heat Added (Q):</strong> <span id="q-val">0</span> J</div>
        <div><strong>Internal Energy (Î”U):</strong> <span id="u-val">0</span> J (Temp: <span id="t-val">300</span>K)</div>
        <div><strong>Work Done (W):</strong> <span id="w-val">0</span> J (Piston Height)</div>
        <hr>
        <div class="eqn">Verification: <span id="q-total">0</span> = <span id="u-total">0</span> + <span id="w-total">0</span></div>
    </div>

    <script>
        let Q = 0, dU = 0, W = 0, Temp = 300, height = 150;
        let heatingInterval;
        const container = document.getElementById('sim-container');
        const atoms = [];

        // Create 20 "Atoms"
        for(let i=0; i<20; i++) {
            let div = document.createElement('div');
            div.className = 'atom';
            container.appendChild(div);
            atoms.push({
                el: div,
                x: Math.random() * 280,
                y: Math.random() * 140,
                vx: (Math.random() - 0.5) * 2,
                vy: (Math.random() - 0.5) * 2
            });
        }

        function updateAtoms() {
            let speedLimit = Temp / 50;
            atoms.forEach(a => {
                a.x += a.vx * (Temp/100);
                a.y += a.vy * (Temp/100);

                if(a.x <= 0 || a.x >= 290) a.vx *= -1;
                if(a.y <= 0) a.vy *= -1;
                if(a.y >= height - 10) a.vy *= -1; // Bounce off piston

                a.el.style.left = a.x + 'px';
                a.el.style.bottom = a.y + 'px';
                a.el.style.background = `rgb(${Math.min(255, Temp - 100)}, 50, ${Math.max(0, 500 - Temp)})`;
            });
            requestAnimationFrame(updateAtoms);
        }

        function startHeat() {
            document.getElementById('flame').style.display = 'block';
            heatingInterval = setInterval(() => {
                Q += 2;
                dU += 1.2; // 60% to internal energy
                W += 0.8;  // 40% to work
                Temp += 0.5;
                height += 0.4;
                
                updateDisplay();
            }, 50);
        }

        function stopHeat() {
            document.getElementById('flame').style.display = 'none';
            clearInterval(heatingInterval);
        }

        function updateDisplay() {
            document.getElementById('piston').style.bottom = height + 'px';
            document.getElementById('q-val').innerText = Q.toFixed(0);
            document.getElementById('u-val').innerText = dU.toFixed(0);
            document.getElementById('w-val').innerText = W.toFixed(0);
            document.getElementById('t-val').innerText = Temp.toFixed(0);
            
            document.getElementById('q-total').innerText = Q.toFixed(0);
            document.getElementById('u-total').innerText = dU.toFixed(0);
            document.getElementById('w-total').innerText = W.toFixed(0);
        }

        function resetSim() {
            Q = 0; dU = 0; W = 0; Temp = 300; height = 150;
            updateDisplay();
        }

        updateAtoms();
    </script>
</body>
</html>
